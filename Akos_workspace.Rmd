---
title: "Akosua Project"
author: "Akos Gyan"
date: "2025-04-29"
output: html_document
---

```{r setup, include=FALSE}
# Load your packages
install.packages("dataRetrieval")
library(tidyverse)
library("dataRetrieval")

library(dplyr)
library(lubridate)
library(tidyverse)
library(dataRetrieval)
library(lubridate)

# Set working directory (if needed)
library(here)
here()

### Pull pH Data (Before: Sept 2023 - March 2024)

FBR_HotSprings.ph.before <- readNWISuv("03454500", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
FBR_Marshall.ph.before <- readNWISuv("03453500", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
FBR_Asheville.ph.before <- readNWISuv("03451500", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
BeetreeCreek_Swannanoa.ph.before <- readNWISuv("03450000", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
NFSwannanoa_Walkertown.ph.before <- readNWISuv("0344894205", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
Swannanoa_Biltmore.ph.before <- readNWISuv("03451000", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
FBR_Fletcher.ph.before <- readNWISuv("03447687", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
FBR_Blantyre.ph.before <- readNWISuv("03443000", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")
FBR_Rosman.ph.before <- readNWISuv("03439000", "00400", "2023-09-27", "2024-03-27", tz = "America/New_York")

### Pull pH Data (After: Sept 2024 - March 2025)

FBR_HotSprings.ph.after <- readNWISuv("03454500", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
FBR_Marshall.ph.after <- readNWISuv("03453500", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
FBR_Asheville.ph.after <- readNWISuv("03451500", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
BeetreeCreek_Swannanoa.ph.after <- readNWISuv("03450000", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
NFSwannanoa_Walkertown.ph.after <- readNWISuv("0344894205", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
Swannanoa_Biltmore.ph.after <- readNWISuv("03451000", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
FBR_Fletcher.ph.after <- readNWISuv("03447687", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
FBR_Blantyre.ph.after <- readNWISuv("03443000", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")
FBR_Rosman.ph.after <- readNWISuv("03439000", "00400", "2024-09-27", "2025-03-27", tz = "America/New_York")

### Clean all the datasets
# Rename columns and remove qualifiers
FBR_HotSprings.ph.before <- FBR_HotSprings.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Marshall.ph.before <- FBR_Marshall.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Asheville.ph.before <- FBR_Asheville.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
BeetreeCreek_Swannanoa.ph.before <- BeetreeCreek_Swannanoa.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
NFSwannanoa_Walkertown.ph.before <- NFSwannanoa_Walkertown.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
Swannanoa_Biltmore.ph.before <- Swannanoa_Biltmore.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Fletcher.ph.before <- FBR_Fletcher.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Blantyre.ph.before <- FBR_Blantyre.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Rosman.ph.before <- FBR_Rosman.ph.before %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)

FBR_HotSprings.ph.after <- FBR_HotSprings.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Marshall.ph.after <- FBR_Marshall.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Asheville.ph.after <- FBR_Asheville.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
BeetreeCreek_Swannanoa.ph.after <- BeetreeCreek_Swannanoa.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
NFSwannanoa_Walkertown.ph.after <- NFSwannanoa_Walkertown.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
Swannanoa_Biltmore.ph.after <- Swannanoa_Biltmore.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Fletcher.ph.after <- FBR_Fletcher.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Blantyre.ph.after <- FBR_Blantyre.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
FBR_Rosman.ph.after <- FBR_Rosman.ph.after %>% rename(ph_su = X_00400_00000) %>% select(-X_00400_00000_cd)
```


```{r setup, include=FALSE}
head(FBR_HotSprings.ph.before)
```


```{r setup, include=FALSE}
available_data <- whatNWISdata(siteNumber = "03454500", service = "uv")
View(available_data)
```
```{r}
available_data_marshall <- whatNWISdata(siteNumber = "03453500", service = "uv")
View(available_data_marshall)

```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```
```{r}
# Load required package
library(dataRetrieval)
library(dplyr)

# Define your site numbers and names
site_list <- data.frame(
  site_name = c(
    "HotSprings", "Marshall", "Asheville", "BeetreeCreek_Swannanoa",
    "NFSwannanoa_Walkertown", "Swannanoa_Biltmore", "Fletcher",
    "Blantyre", "Rosman"
  ),
  site_number = c(
    "03454500", "03453500", "03451500", "03450000",
    "0344894205", "03451000", "03447687",
    "03443000", "03439000"
  )
)

# Create an empty list to store results
ph_availability <- list()

# Loop through each site and check for pH data (00408)
for (i in 1:nrow(site_list)) {
  site <- site_list$site_number[i]
  name <- site_list$site_name[i]
  
  message("Checking site: ", name, " (", site, ")")
  
  data <- whatNWISdata(siteNumber = site, service = "uv") %>%
    filter(parm_cd == "00408")
  
  if (nrow(data) > 0) {
    ph_availability[[name]] <- paste("✅ pH data available for", name, "(", site, ")")
  } else {
    ph_availability[[name]] <- paste("❌ No pH data found for", name, "(", site, ")")
  }
}

# Print summary
cat("\n=== pH Data Availability Summary ===\n")
for (result in ph_availability) {
  cat(result, "\n")
}

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library(dataRetrieval)
library(dplyr)
library(lubridate)
library(ggplot2)

# 1. Define USGS site numbers (gauge stations)
site_ids <- c(
  "03454500", "03453500", "03451500", "03450000", "0344894205",
  "03451000", "03447687", "03443000", "03439000"
)

# 2. Define the time periods (before and after Hurricane Helene)
before_start <- "2023-09-01"
before_end   <- "2024-03-31"
after_start  <- "2024-09-01"
after_end    <- "2025-03-31"

# 3. Function to download daily discharge data for a site
get_discharge_data <- function(site, start, end) {
  readNWISdv(siteNumbers = site,
             parameterCd = "00060",  # 00060 = Discharge in cubic feet per second
             startDate = start,
             endDate = end) %>%
    mutate(site_no = site)
}

# 4. Download discharge data for all sites (before and after)
discharge_before <- bind_rows(lapply(site_ids, get_discharge_data, start = before_start, end = before_end))
discharge_after  <- bind_rows(lapply(site_ids, get_discharge_data, start = after_start, end = after_end))

# 5. Function to calculate monthly mean discharge
process_monthly_mean <- function(df, label) {
  df %>%
    rename(discharge = X_00060_00003) %>%  # Daily mean discharge column
    mutate(month = floor_date(as.Date(Date), "month")) %>%
    group_by(site_no, month) %>%
    summarise(mean_discharge = mean(discharge, na.rm = TRUE), .groups = "drop") %>%
    mutate(period = label)
}

monthly_before <- process_monthly_mean(discharge_before, "Before")
monthly_after  <- process_monthly_mean(discharge_after, "After")

# 6. Combine both periods
combined_monthly <- bind_rows(monthly_before, monthly_after)

# 7. Time series plot: discharge by site and period
ggplot(combined_monthly, aes(x = month, y = mean_discharge, color = period)) +
  geom_line() +
  facet_wrap(~ site_no, scales = "free_y") +
  labs(
    title = "Monthly Mean Discharge Before and After Hurricane Helene",
    x = "Month",
    y = "Mean Discharge (cfs)",
    color = "Period"
  ) +
  theme_minimal()
```

